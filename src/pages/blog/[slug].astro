---
import Layout from "../../layouts/Layout.astro";
import Footer from "../../components/Footer.astro";
import BlogPostSchema from "../../components/seo/BlogPostSchema.astro";
import BreadcrumbSchema from "../../components/seo/BreadcrumbSchema.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export const prerender = true;

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

interface Props {
	post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { Content } = await post.render();

// Calculate reading time from content (rough estimate: 200 words/min)
const wordCount = post.body.split(/\s+/).length;
const readingTime = post.data.readingTime || Math.ceil(wordCount / 200);

// Format dates
const publishDate = post.data.publishDate.toLocaleDateString("nl-NL", {
	year: "numeric",
	month: "long",
	day: "numeric",
});

const updatedDate = post.data.updatedDate?.toLocaleDateString("nl-NL", {
	year: "numeric",
	month: "long",
	day: "numeric",
});

// SEO
const metaTitle = post.data.metaTitle || `${post.data.title} | KNAP GEMAAKT.`;
const metaDescription = post.data.description;

const breadcrumbs = [
	{ name: "Home", url: "https://knapgemaakt.nl/" },
	{ name: "Blog", url: "https://knapgemaakt.nl/blog" },
	{ name: post.data.title, url: `https://knapgemaakt.nl/blog/${post.slug}` },
];
---

<Layout title={metaTitle} description={metaDescription}>
	<BlogPostSchema
		title={post.data.title}
		description={post.data.description}
		publishDate={post.data.publishDate}
		updatedDate={post.data.updatedDate}
		author={post.data.author}
		slug={post.slug}
		tags={post.data.tags}
		readingTime={readingTime}
		image={post.data.image}
	/>
	<BreadcrumbSchema items={breadcrumbs} />

	<main>
		<!-- Article Header -->
		<article class="pt-32 pb-16 md:pb-24 px-6 md:px-12 lg:px-16 bg-canvas bg-grid-light relative overflow-hidden">
			<div class="max-w-3xl mx-auto relative z-10">
				<!-- Back Link -->
				<a
					href="/blog"
					class="inline-flex items-center gap-2 text-ink/50 hover:text-ink font-mono text-sm uppercase tracking-wider mb-8 transition-colors"
				>
					<span>&larr;</span>
					<span>Terug naar blog</span>
				</a>

				<!-- Meta -->
				<div class="flex flex-wrap items-center gap-3 mb-6 text-sm font-mono uppercase tracking-wider text-ink/50">
					<time datetime={post.data.publishDate.toISOString()}>
						{publishDate}
					</time>
					<span class="w-1 h-1 bg-ink/30 rounded-full"></span>
					<span>{readingTime} min lezen</span>
					{updatedDate && (
						<>
							<span class="w-1 h-1 bg-ink/30 rounded-full"></span>
							<span>Bijgewerkt: {updatedDate}</span>
						</>
					)}
				</div>

				<!-- Title -->
				<h1 class="text-4xl md:text-5xl lg:text-6xl font-black uppercase tracking-tight leading-[0.95] mb-6">
					{post.data.title}
				</h1>

				<!-- Tags -->
				{post.data.tags.length > 0 && (
					<div class="flex flex-wrap gap-2 mb-8">
						{post.data.tags.map((tag) => (
							<span class="px-3 py-1 bg-acid text-ink text-xs font-mono font-bold uppercase tracking-wider">
								{tag}
							</span>
						))}
					</div>
				)}

				<!-- Description -->
				<p class="text-xl text-ink/70 leading-relaxed">
					{post.data.description}
				</p>
			</div>
		</article>

		<!-- Article Content -->
		<section class="py-16 md:py-24 px-6 md:px-12 lg:px-16 bg-ink text-canvas bg-grid-dark">
			<div class="max-w-3xl mx-auto">
				<div class="blog-content">
					<Content />
				</div>
			</div>
		</section>

		<!-- Author Section -->
		<section class="py-16 md:py-24 px-6 md:px-12 lg:px-16 bg-canvas bg-grid-light">
			<div class="max-w-3xl mx-auto">
				<div class="border border-ink/10 p-8">
					<div class="flex items-start gap-4">
						<img
							src="/assets/yannick.jpeg"
							alt="Yannick"
							class="w-12 h-12 rounded-full object-cover object-top flex-shrink-0"
						/>
						<div>
							<p class="font-bold text-lg mb-1">{post.data.author}</p>
							<p class="text-ink/60 text-sm leading-relaxed">
								Ik bouw slimme websites voor ondernemers. Snel, zonder gedoe, met automatisering die voor je werkt.
							</p>
						</div>
					</div>
				</div>
			</div>
		</section>

		<Footer />
	</main>
</Layout>
