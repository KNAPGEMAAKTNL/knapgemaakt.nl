---
import Layout from "../../layouts/Layout.astro";
import Footer from "../../components/Footer.astro";
import BlogCard from "../../components/blog/BlogCard.astro";
import BreadcrumbSchema from "../../components/seo/BreadcrumbSchema.astro";
import { getCollection } from "astro:content";

export const prerender = true;

// Get all non-draft blog posts, sorted by date (newest first)
const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
	(a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

// Extract unique tags for filtering
const allTags = [...new Set(sortedPosts.flatMap((post) => post.data.tags))].sort();

// SEO
const metaTitle = "Blog | Tips voor Ondernemers | KNAP GEMAAKT.";
const metaDescription =
	"Lees onze artikelen over webdesign, online zichtbaarheid en websites voor ondernemers. Praktische tips, prijsinformatie en vergelijkingen.";

const breadcrumbs = [
	{ name: "Home", url: "https://knapgemaakt.nl/" },
	{ name: "Blog", url: "https://knapgemaakt.nl/blog" },
];
---

<Layout title={metaTitle} description={metaDescription}>
	<BreadcrumbSchema items={breadcrumbs} />

	<main>
		<!-- Hero Section -->
		<section class="pt-32 pb-16 md:pb-24 px-6 md:px-12 lg:px-16 bg-canvas bg-grid-light relative overflow-hidden">
			<div class="max-w-6xl xl:max-w-7xl mx-auto relative z-10">
				<div class="text-xs font-mono uppercase tracking-[0.2em] text-ink/40 mb-4">
					[ Artikelen & Inzichten ]
				</div>
				<h1 class="text-5xl md:text-7xl lg:text-8xl font-black uppercase tracking-tight leading-[0.9] mb-6">
					Blog
				</h1>
				<p class="text-xl md:text-2xl text-ink/60 max-w-2xl">
					Tips, gidsen en inzichten over webdesign voor ondernemers.
					Alles wat je moet weten over het laten maken van een website.
				</p>
			</div>
		</section>

		<!-- Tags Filter -->
		{allTags.length > 0 && (
			<section class="px-6 md:px-12 lg:px-16 bg-canvas border-b border-ink/10">
				<div class="max-w-6xl xl:max-w-7xl mx-auto py-6">
					<div class="flex flex-wrap items-center gap-3">
						<span class="text-xs font-mono uppercase tracking-wider text-ink/40">
							Filter:
						</span>
						<a
							href="/blog"
							class="px-3 py-1.5 text-xs font-mono uppercase tracking-wider bg-acid text-ink"
						>
							Alle
						</a>
						{allTags.map((tag) => (
							<a
								href={`/blog/tag/${tag.toLowerCase().replace(/\s+/g, "-")}`}
								class="px-3 py-1.5 text-xs font-mono uppercase tracking-wider bg-ink/5 text-ink/60 hover:bg-acid hover:text-ink transition-colors"
							>
								{tag}
							</a>
						))}
					</div>
				</div>
			</section>
		)}

		<!-- Blog Posts Grid -->
		<section class="py-16 md:py-24 bg-ink text-canvas bg-grid-dark relative overflow-hidden">
			<div class="max-w-6xl xl:max-w-7xl mx-auto px-6 md:px-12 lg:px-16">
				{sortedPosts.length > 0 ? (
					<div class="grid md:grid-cols-2 gap-8">
						{sortedPosts.map((post) => (
							<BlogCard
								title={post.data.title}
								description={post.data.description}
								publishDate={post.data.publishDate}
								slug={post.slug}
								tags={post.data.tags}
								readingTime={post.data.readingTime}
							/>
						))}
					</div>
				) : (
					<div class="text-center py-16">
						<p class="text-canvas/60 text-lg">
							Binnenkort verschijnen hier onze eerste artikelen.
						</p>
					</div>
				)}
			</div>
		</section>

		<Footer />
	</main>
</Layout>
