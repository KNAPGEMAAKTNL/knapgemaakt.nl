---
import Layout from "../layouts/Layout.astro";
import OfferSection from "../components/OfferSection.astro";
import PortfolioSection from "../components/PortfolioSection.astro";
import LocalSEOSection from "../components/LocalSEOSection.astro";
import Footer from "../components/Footer.astro";
import { getCityBySlug, getAllCities } from "../data/cities";
import LocalBusinessSchema from "../components/seo/LocalBusinessSchema.astro";
import BreadcrumbSchema from "../components/seo/BreadcrumbSchema.astro";
import FAQSchema from "../components/seo/FAQSchema.astro";

export const prerender = true;

export function getStaticPaths() {
    // Get available city images at build time
    const cityImages = import.meta.glob("/public/cities/*.webp");
    const availableCityImages = new Set(
        Object.keys(cityImages).map((path) =>
            path.replace("/public/cities/", "").replace(".webp", ""),
        ),
    );

    // Get all cities from our data file
    const allCities = getAllCities();

    return allCities.map((cityData) => ({
        params: { city: cityData.slug },
        props: {
            cityData,
            hasCityImage: availableCityImages.has(cityData.slug),
        },
    }));
}

const { cityData, hasCityImage } = Astro.props;
const city = cityData.name;

const cityImageFilename = `${cityData.slug}.webp`;
const mapImage = hasCityImage
    ? `/cities/${cityImageFilename}`
    : "/city_map.webp";

// SEO-optimized meta description using city data
const metaDescription = `Professionele webdesign in ${city}. Wij bouwen snelle, moderne websites voor ondernemers in ${cityData.region}. Klaar in 7 dagen voor €595. Vraag nu aan!`;

// SEO-optimized title (no brand name - it's the domain)
const pageTitle = `Webdesign ${city} | Website Laten Maken in ${cityData.region} - €595`;

// Breadcrumb data for this page
const breadcrumbs = [
	{ name: "Home", url: "https://knapgemaakt.nl/" },
	{ name: `Webdesign ${city}`, url: `https://knapgemaakt.nl/webdesign-${cityData.slug}/` }
];
---

<Layout
	title={pageTitle}
	description={metaDescription}
>
	<LocalBusinessSchema />
	<BreadcrumbSchema items={breadcrumbs} />
	{cityData.faqs && <FAQSchema faqs={cityData.faqs} />}
	<main>
        <!-- Hero Section -->
        <section class="flex items-start bg-canvas bg-grid-light relative overflow-hidden pt-24 md:pt-32 pb-16 md:pb-24">
            <div class="max-w-6xl xl:max-w-7xl mx-auto px-6 md:px-12 lg:px-16 w-full">
                <div class="grid md:grid-cols-2 gap-8 md:gap-12 items-center">
                    <!-- Text Content -->
                    <div class="space-y-6">
                        <div class="text-xs font-mono uppercase tracking-[0.2em] text-ink/40">
                            [ Knap Gemaakt . {cityData.region} ]
                        </div>
                        <h1 class="text-4xl md:text-5xl lg:text-6xl font-black uppercase tracking-tighter leading-[0.9]">
                            Webdesign in<br />
                            <span class="text-electric">{city}.</span>
                        </h1>
                        <p class="text-lg md:text-xl text-ink/70">
                            Je onderneming verdient beter dan een matige website.
                        </p>
                        <a
                            href="/aanvragen"
                            class="w-full sm:w-auto bg-acid text-ink px-8 py-5 font-bold uppercase tracking-tight hover:bg-ink hover:text-acid transition-colors duration-300 inline-flex items-center justify-center gap-3 group"
                        >
                            <span>Plan Je Gratis Gesprek</span>
                            <span class="transition-transform duration-300 group-hover:translate-x-1">&rarr;</span>
                        </a>
                    </div>

                    <!-- Map Image -->
                    <div class="relative">
                        <div class="aspect-square md:aspect-[4/3] relative overflow-hidden group">
                            <img
                                src={mapImage}
                                alt={`Kaart van ${city} - Knap Gemaakt webdesign actief in ${cityData.region}`}
                                width={1024}
                                height={768}
                                loading="eager"
                                fetchpriority="high"
                                decoding="async"
                                class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                            />
                            <div class="absolute inset-0 bg-gradient-to-t from-ink via-ink/40 to-transparent"></div>
                            <div class="absolute bottom-0 left-0 right-0 p-4 md:p-6 text-center">
                                <div class="font-mono uppercase tracking-[0.2em] text-acid text-xs mb-1">
                                    Actief in
                                </div>
                                <div class="font-black uppercase tracking-tighter text-canvas" style="font-size: clamp(1.25rem, 5vw, 2.5rem);">
                                    {city}
                                </div>
                                <div class="font-mono uppercase tracking-widest text-canvas/60 text-xs mt-1">
                                    & Omgeving
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Local SEO Content Section -->
        <LocalSEOSection city={cityData} />

        <!-- Portfolio -->
        <PortfolioSection />

        <!-- Pricing & Offer -->
        <OfferSection />

        <!-- Footer -->
        <Footer />
    </main>
</Layout>
