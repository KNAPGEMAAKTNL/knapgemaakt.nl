---
import type { CityData } from "../data/cities";
import { getAllCities } from "../data/cities";
import { getProjectBySlug } from "../data/projects";

interface Props {
	city: CityData;
}

const { city } = Astro.props;

// Get related project if available
const relatedProject = city.relatedProject ? getProjectBySlug(city.relatedProject) : null;

// Get all city slugs to check which nearby areas have pages
const allCities = getAllCities();
const citySlugs = new Set(allCities.map(c => c.slug));

// Helper to convert area name to slug and check if page exists
function getAreaLink(areaName: string): string | null {
	const slug = areaName.toLowerCase()
		.replace(/['']/g, '')  // Remove apostrophes ('t Goy -> t goy)
		.replace(/\s+/g, '-')   // Replace spaces with hyphens
		.replace(/[^a-z0-9-]/g, ''); // Remove special chars
	return citySlugs.has(slug) ? `/webdesign-${slug}` : null;
}
---

<section class="bg-canvas py-16 md:py-24 px-6 md:px-12 lg:px-16 bg-grid-light relative overflow-hidden">
    <div class="max-w-6xl xl:max-w-7xl mx-auto relative z-10">
        <!-- Section Header -->
        <div class="mb-16">
            <div
                class="font-mono text-sm text-electric uppercase tracking-widest mb-4"
            >
                [ Webdesign in {city.region} ]
            </div>
            <h2
                class="text-4xl md:text-6xl font-black uppercase tracking-tighter leading-none mb-6"
            >
                Waarom Kiezen Voor Een
                <span class="text-electric">Lokale</span> Partner?
            </h2>
        </div>

        <!-- City Statistics Bar (unique per city) -->
        {city.stats && (
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-16 p-6 bg-ink text-canvas">
                {city.stats.businesses && (
                    <div class="text-center md:text-left">
                        <div class="text-2xl md:text-3xl font-black text-acid">{city.stats.businesses}</div>
                        <div class="text-xs font-mono uppercase tracking-wider text-canvas/60">Actief in {city.name}</div>
                    </div>
                )}
                {city.stats.mainIndustry && (
                    <div class="text-center md:text-left">
                        <div class="text-sm md:text-base font-bold text-canvas">{city.stats.mainIndustry}</div>
                        <div class="text-xs font-mono uppercase tracking-wider text-canvas/60">Belangrijkste sector</div>
                    </div>
                )}
                {city.stats.founded && (
                    <div class="text-center md:text-left">
                        <div class="text-sm md:text-base font-bold text-canvas">{city.stats.founded}</div>
                        <div class="text-xs font-mono uppercase tracking-wider text-canvas/60">Historie</div>
                    </div>
                )}
                {city.population && (
                    <div class="text-center md:text-left">
                        <div class="text-sm md:text-base font-bold text-canvas">{city.population}</div>
                        <div class="text-xs font-mono uppercase tracking-wider text-canvas/60">Gemeente</div>
                    </div>
                )}
            </div>
        )}

        <!-- Economic Fact Callout (unique per city) -->
        {city.stats?.economicFact && (
            <div class="mb-16 p-6 border-l-4 border-electric bg-electric/5">
                <p class="text-lg md:text-xl text-ink/80 italic">
                    "{city.stats.economicFact}"
                </p>
            </div>
        )}

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 mb-16">
            <!-- Left Column: City Introduction -->
            <div class="space-y-8">
                <div>
                    <h3
                        class="text-2xl font-black uppercase tracking-tighter mb-4 flex items-center gap-3"
                    >
                        <span class="text-electric font-mono text-lg">[01]</span
                        >
                        Over {city.name}
                    </h3>
                    <p class="text-lg text-ink/80 leading-relaxed">
                        {city.description}
                    </p>
                    {
                        city.population && (
                            <p class="text-sm font-mono text-ink/50 mt-3">
                                {city.name} • {city.population} •{" "}
                                {city.region}
                            </p>
                        )
                    }
                </div>

                <div>
                    <h3
                        class="text-2xl font-black uppercase tracking-tighter mb-4 flex items-center gap-3"
                    >
                        <span class="text-electric font-mono text-lg">[02]</span
                        >
                        Online Zichtbaarheid
                    </h3>
                    <p class="text-lg text-ink/80 leading-relaxed">
                        {city.businessContext}
                    </p>
                </div>
            </div>

            <!-- Right Column: Local Focus & Why Us -->
            <div class="space-y-8">
                <div
                    class="bg-ink text-canvas p-8 md:p-10 relative overflow-hidden"
                >
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-electric/10 rounded-full blur-3xl"
                    >
                    </div>
                    <div class="relative z-10">
                        <h3
                            class="text-2xl font-black uppercase tracking-tighter mb-4 flex items-center gap-3"
                        >
                            <span class="text-acid font-mono text-lg">[03]</span
                            >
                            Ons Lokale Voordeel
                        </h3>
                        <p class="text-lg text-canvas/80 leading-relaxed">
                            {city.localFocus}
                        </p>
                    </div>
                </div>

                <!-- Nearby Areas -->
                <div>
                    <h4
                        class="font-mono text-xs uppercase tracking-widest text-ink/50 mb-4"
                    >
                        Ook actief in de omgeving
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        {
                            city.nearbyAreas.map((area) => {
                                const link = getAreaLink(area);
                                return link ? (
                                    <a href={link} class="px-4 py-2 bg-[#e8e8e8] text-ink/80 font-medium text-sm hover:bg-electric hover:text-ink transition-colors">
                                        {area}
                                    </a>
                                ) : (
                                    <span class="px-4 py-2 bg-[#e8e8e8] text-ink/80 font-medium text-sm">
                                        {area}
                                    </span>
                                );
                            })
                        }
                    </div>
                </div>

                {
                    city.landmarks && (
                        <div>
                            <h4 class="font-mono text-xs uppercase tracking-widest text-ink/50 mb-3">
                                Bekende plekken in {city.name}
                            </h4>
                            <p class="text-ink/60 text-sm">{city.landmarks}</p>
                        </div>
                    )
                }
            </div>
        </div>

        <!-- Target Industries (unique per city) -->
        {city.targetIndustries && city.targetIndustries.length > 0 && (
            <div class="mb-16 p-8 bg-[#f5f5f5] border border-ink/5">
                <h3 class="text-xl font-black uppercase tracking-tighter mb-2">
                    Websites voor ondernemers in {city.name}
                </h3>
                <p class="text-ink/60 text-sm mb-6">
                    Wij bouwen websites voor diverse sectoren in {city.region}. Onze ervaring met lokale bedrijven:
                </p>
                <div class="flex flex-wrap gap-3">
                    {city.targetIndustries.map((industry) => (
                        <span class="px-4 py-2 bg-ink text-canvas text-sm font-medium">
                            {industry}
                        </span>
                    ))}
                </div>
            </div>
        )}

        <!-- Why Local Matters - Full Width -->
        <div
            class="border-t border-ink/10 pt-12 grid grid-cols-1 md:grid-cols-3 gap-8"
        >
            <div>
                <div
                    class="text-4xl font-black text-electric mb-3 font-mono tracking-tight"
                >
                    01.
                </div>
                <h4 class="font-bold uppercase tracking-tight mb-2">
                    Korte Lijnen
                </h4>
                <p class="text-ink/70 text-sm leading-relaxed">
                    Geen callcenters of ticketsystemen. Direct contact met
                    iemand die {city.name} kent en jouw situatie begrijpt.
                </p>
            </div>
            <div>
                <div
                    class="text-4xl font-black text-electric mb-3 font-mono tracking-tight"
                >
                    02.
                </div>
                <h4 class="font-bold uppercase tracking-tight mb-2">
                    Lokale Kennis
                </h4>
                <p class="text-ink/70 text-sm leading-relaxed">
                    Wij begrijpen wat werkt voor ondernemers in {city.name}.
                    Die kennis vertalen we naar een website die aansluit bij
                    jouw doelgroep.
                </p>
            </div>
            <div>
                <div
                    class="text-4xl font-black text-electric mb-3 font-mono tracking-tight"
                >
                    03.
                </div>
                <h4 class="font-bold uppercase tracking-tight mb-2">
                    Geen Gedoe
                </h4>
                <p class="text-ink/70 text-sm leading-relaxed">
                    Vragen? Even bellen of appen. Geen wachttijden, geen
                    onduidelijkheid. Zo werken wij met ondernemers in {city.name}
                    en omgeving.
                </p>
            </div>
        </div>

		<!-- Related Project (if available) -->
		{relatedProject && (
			<div class="mt-12 pt-12 border-t border-ink/10">
				<div class="font-mono text-xs uppercase tracking-widest text-ink/50 mb-4">
					[ Ons Werk in {city.region} ]
				</div>
				<div class="grid md:grid-cols-2 gap-8 items-center">
					<div>
						<h3 class="text-2xl font-black uppercase tracking-tighter mb-3">
							{relatedProject.title}
						</h3>
						<p class="text-ink/70 leading-relaxed mb-4">
							{relatedProject.shortDescription}
						</p>
						<a
							href={`/project/${relatedProject.slug}`}
							class="text-electric font-mono text-sm uppercase tracking-wider hover:text-ink transition-colors inline-flex items-center gap-2 group"
						>
							<span>Bekijk Case Study</span>
							<span class="transition-transform duration-300 group-hover:translate-x-1">&rarr;</span>
						</a>
					</div>
					<a href={`/project/${relatedProject.slug}`} class="relative aspect-video overflow-hidden bg-ink/5 block group">
						<img
							src={relatedProject.image}
							alt={`${relatedProject.title} website voorbeeld`}
							width={800}
							height={450}
							loading="lazy"
							decoding="async"
							class="w-full h-full object-cover object-top transition-transform duration-700 group-hover:scale-105"
						/>
						<div class="absolute inset-0 bg-ink/0 group-hover:bg-ink/60 transition-colors duration-300 flex items-center justify-center">
							<span class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-acid text-ink px-6 py-3 font-bold uppercase tracking-tight text-sm">
								Bekijk Project
							</span>
						</div>
					</a>
				</div>
			</div>
		)}

		<!-- FAQ Section -->
		{city.faqs && city.faqs.length > 0 && (
			<div class="mt-12 pt-12 border-t border-ink/10">
				<div class="font-mono text-xs uppercase tracking-widest text-ink/50 mb-4">
					[ Veelgestelde Vragen ]
				</div>
				<h3 class="text-2xl md:text-3xl font-black uppercase tracking-tighter mb-8">
					Webdesign in {city.name}
				</h3>
				<div class="grid md:grid-cols-2 gap-6">
					{city.faqs.map((faq) => (
						<div class="space-y-2">
							<h4 class="font-bold text-ink">{faq.question}</h4>
							<p class="text-ink/70 text-sm leading-relaxed">{faq.answer}</p>
						</div>
					))}
				</div>
			</div>
		)}
    </div>
</section>
